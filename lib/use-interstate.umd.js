!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).useInterstate={},t.React)}(this,(function(t,e){"use strict";function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,u,a=[],o=!0,i=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){i=!0,u=t}finally{try{o||null==r.return||r.return()}finally{if(i)throw u}}return a}(t,e)||i(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var f=function(t){return[].concat(o(Object.getOwnPropertyNames(t)),o(Object.getOwnPropertySymbols(t))).filter((function(e){return Object.prototype.propertyIsEnumerable.call(t,e)})).map((function(e){return[e,t[e]]}))},s=function(t,e){for(var r=t.start;r;)e(r),r=r.next},l=function(t,e){var r=n({},e);if(function(t){return t.start}(t)){var u=[t.start,r,r];r.next=u[0],t.start.prev=u[1],t.start=u[2]}else t.start=r;return r};var v={prev:"next",next:"prev"},g=function(t,e){function r(t,r){var n=e[t],u=v[t];return n?(n[u]=e[u],r):e[u]}e.beenRemoved||(t.start=r("prev",t.start),r("next"),e.beenRemoved=!0)};function b(t){var e=function(){var t,e=new Map,r={};function u(n,u){e.set(n,u),Object.defineProperty(r,n,{enumerable:!0,get:function(){return t(n)},configurable:!1})}return{stateMap:{get:function(t){if(e.has(t))return e.get(t);var r={reactTriggersList:{}};return u(t,r),r},set:function(t,e){var r=n(n({},e),{},{reactTriggersList:{}});return u(t,r),r}},getAccessHandler:function(e){return t=e,r},clearState:function(){e.clear(),r={}}}}(),r=e.stateMap,u=e.getAccessHandler,o=e.clearState,i={},c=!1,v=!1,b=[],p=[];m(t);var y=function(t){var e;return null===(e=r.get(t).stateValue)||void 0===e?void 0:e.value},d=function(t,e){return t(u(e))};return{getValue:y,getStateUsingSelector:d,setValue:function(t,e){var n=r.get(t),u=n.stateValue;n.stateValue={value:e},n.reactTriggersList.triggersFired||u&&Object.is(u.value,e)||(s(n.reactTriggersList,(function(t){(0,t.trigger)()})),n.reactTriggersList.start&&(n.reactTriggersList.triggersFired=!0,b.push((function(){return n.reactTriggersList.triggersFired=!1}))))},resetValue:function(t){o(),m(t),i={},c=!1,v=!1,b=[],p=[]},reactSubscribeState:function(t,e,n){var u,o=!1,c=[];if(n){var f=Object.fromEntries(n.map((function(t){var e,n=a(t,2),u=n[0],o=n[1],i=r.get(u);return void 0===o||i.stateValue||(i.stateValue={value:o},s(i.reactTriggersList,(function(t){var e=t.trigger;p.push((function(){e()}))}))),c.push(v(i)),[u,null===(e=i.stateValue)||void 0===e?void 0:e.value]})));u=e(f)}else u=d(e,(function(t){var e,n=r.get(t);return c.push(v(n)),null===(e=n.stateValue)||void 0===e?void 0:e.value}));function v(e){var r=l(e.reactTriggersList,{trigger:function(){o=!0,t()}});return function(){g(e.reactTriggersList,r)}}var b=function(){c.forEach((function(t){t()})),c=[]},m=l(i,{removeTriggerFromKeyList:function(){b()}});return{retrieveValue:function(){return o&&(o=!1,u=d(e,y)),u},unsubscribe:b,removeFromWatchList:function(){g(i,m)}}},reactRenderTask:function(){c||(c=!0,v=!1,s(i,(function(t){(0,t.removeTriggerFromKeyList)()})),b.forEach((function(t){return t()})),b=[],i={})},reactEffectTask:function(){v||(v=!0,c=!1,p.forEach((function(t){return t()})),p=[])}};function m(t){t&&f(t).forEach((function(t){var e=a(t,2),n=e[0],u=e[1];void 0!==u&&r.set(n,{stateValue:{value:u}})}))}}var p=function(t){return"function"==typeof t};function y(t){return Array.isArray(t)}function d(t){return"number"==typeof t?"".concat(t):t}t.initInterstate=function(t){var r=b(t),n=r.getValue,u=r.setValue,o=r.resetValue,i=r.getStateUsingSelector,c=r.reactSubscribeState,s=r.reactRenderTask,l=r.reactEffectTask,v=function(){s(),e.useEffect(l);var t=e.useState((function(){var t,r,n;return{useGetState:function(u){var o=a(e.useState({}),2)[1];if(u){var i;null===(i=r)||void 0===i||i();var f=u.getValueFromState,s=u.initValues,l=c((function(){o({})}),f,s);t=l.retrieveValue,r=l.unsubscribe,n=l.removeFromWatchList}return e.useEffect(n,[n]),e.useEffect((function(){return function(){r()}}),[]),t()}}}));return a(t,1)[0].useGetState},g=function(t,r){var n=e.useState((function(){var t=null,e=!1,r=null;return{useBody:function(n,u){switch(typeof n){case"object":if(!e){var o=y(n)?n.map((function(t){return[d(t)]})):f(n);r={getValueFromState:function(t){return Object.fromEntries(o.map((function(e){var r=a(e,1)[0];return[r,t[r]]})))},initValues:o};break}r=null;break;case"function":if(!e){var i=f(n());r={getValueFromState:function(t){return Object.fromEntries(i.map((function(e){var r=a(e,1)[0];return[r,t[r]]})))},initValues:i};break}r=null;break;default:var c=d(n);if(!e||null!==t&&c!==t){r={getValueFromState:function(t){return t[c]},initValues:[[c,p(u)?u():u]]},t=c;break}r=null}return e=!0,v()(r)}}}));return(0,a(n,1)[0].useBody)(t,r)};g.acceptSelector=function(t){return(0,a(e.useState((function(){var t=!1;return{useBody:function(e){var r=t?null:{getValueFromState:e};return t=!0,v()(r)}}})),1)[0].useBody)(t)};var m=function(t){return y(t)?Object.fromEntries(t.map((function(t){return[t,n(d(t))]}))):n(d(t))};return m.acceptSelector=function(t){return i(t,n)},{useInterstate:g,setInterstate:function(t,e){switch(typeof t){case"object":f(t).forEach((function(t){var e=a(t,2),n=e[0],u=e[1];r(n,(function(){return u}))}));break;case"function":f(i(t,n)).forEach((function(t){var e=a(t,2),r=e[0],n=e[1];u(r,n)}));break;default:r(d(t),e)}function r(t,e){u(t,p(e)?e(n(t)):e)}},readInterstate:m,resetInterstate:o}},Object.defineProperty(t,"__esModule",{value:!0})}));
