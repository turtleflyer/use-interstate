!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).useInterstate={},e.React)}(this,(function(e,t){"use strict";function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,u=[],i=!0,o=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(o)throw a}}return u}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var f=function(e){return[].concat(i(Object.getOwnPropertyNames(e)),i(Object.getOwnPropertySymbols(e))).filter((function(t){return Object.prototype.propertyIsEnumerable.call(e,t)})).map((function(t){return[t,e[t]]}))},s=function(e,t){for(var r=e.start;r;)t(r),r=r.next},l=function(e,t){var r=n({},t);if(function(e){return e.start}(e)){var a=[e.start,r,r];r.next=a[0],e.start.prev=a[1],e.start=a[2]}else e.start=r;return r};var v={prev:"next",next:"prev"},b=function(e,t){function r(e,r){var n=t[e],a=v[e];return n?(n[a]=t[a],r):t[a]}t.beenRemoved||(e.start=r("prev",e.start),r("next"),t.beenRemoved=!0)};function p(e){var t=function(){var e,t={},r={};function a(n,a){t[n]=a,Object.defineProperty(r,n,{enumerable:!0,get:function(){var t;return e(n),null===(t=a.stateValue)||void 0===t?void 0:t.value},configurable:!1})}return{getStateValue:function(e){if(e in t)return t[e];var r={reactTriggersList:{}};return a(e,r),r},setStateValue:function(e,t){var r=n(n({},t),{},{reactTriggersList:{}});return a(e,r),r},getAccessMapHandler:function(){var t=[];return e=function(e){t.push(e)},{accessMapHandler:r,getKeys:function(){return t}}},clearState:function(){t={},r={}}}}(),r=t.getStateValue,a=t.setStateValue,i=t.getAccessMapHandler,o=t.clearState,c={},v=!1,p=!1,g=[],d=[];y(e);return{getValue:function(e){var t;return null===(t=r(e).stateValue)||void 0===t?void 0:t.value},getStateUsingSelector:function(e){return e(i().accessMapHandler)},setValue:function(e,t){var n=r(e),a=n.stateValue;n.stateValue={value:t},n.reactTriggersList.triggersFired||a&&Object.is(a.value,t)||(s(n.reactTriggersList,(function(e){(0,e.trigger)()})),n.reactTriggersList.start&&(n.reactTriggersList.triggersFired=!0,g.push((function(){return n.reactTriggersList.triggersFired=!1}))))},resetValue:function(e){o(),y(e),c={},v=!1,p=!1,g=[],d=[]},reactSubscribeState:function(e,t,n){var a,o=!1,f=[];if(n){var v=Object.fromEntries(n.map((function(e){var t,n=u(e,2),a=n[0],i=n[1],o=r(a);return void 0===i||o.stateValue||(o.stateValue={value:i},s(o.reactTriggersList,(function(e){var t=e.trigger;d.push((function(){t()}))}))),f.push(m(o)),[a,null===(t=o.stateValue)||void 0===t?void 0:t.value]})));a=t(v)}else{var p=i(),g=p.accessMapHandler,y=p.getKeys;a=t(g),y().forEach((function(e){var t=r(e);f.push(m(t))}))}function m(t){var r=l(t.reactTriggersList,{trigger:function(){o=!0,e()}});return function(){b(t.reactTriggersList,r)}}var S=function(){f.forEach((function(e){e()})),f=[]},h=l(c,{removeTriggerFromKeyList:function(){S()}});return{retrieveValue:function(){if(o){o=!1;var e=i().accessMapHandler;a=t(e)}return a},unsubscribe:S,removeFromWatchList:function(){b(c,h)}}},reactRenderTask:function(){v||(v=!0,p=!1,s(c,(function(e){(0,e.removeTriggerFromKeyList)()})),g.forEach((function(e){return e()})),g=[],c={})},reactEffectTask:function(){p||(p=!0,v=!1,d.forEach((function(e){return e()})),d=[])}};function y(e){e&&f(e).forEach((function(e){var t=u(e,2),r=t[0],n=t[1];void 0!==n&&a(r,{stateValue:{value:n}})}))}}var g=function(e){return"function"==typeof e};function d(e){return Array.isArray(e)}function y(e){return"number"==typeof e?"".concat(e):e}e.initInterstate=function(e){var r=p(e),n=r.getValue,a=r.setValue,i=r.resetValue,o=r.getStateUsingSelector,c=r.reactSubscribeState,s=r.reactRenderTask,l=r.reactEffectTask,v=function(){s(),t.useEffect(l);var e=t.useState((function(){var e,r,n;return{useGetState:function(a){var i=u(t.useState({}),2)[1];if(a){var o;null===(o=r)||void 0===o||o();var f=a.takeStateAndCalculateValue,s=a.initValues,l=c((function(){i({})}),f,s);e=l.retrieveValue,r=l.unsubscribe,n=l.removeFromWatchList}return t.useEffect(n,[n]),t.useEffect((function(){return function(){r()}}),[]),e()}}}));return u(e,1)[0].useGetState},b=function(e,r){var n=t.useState((function(){var e=null,t=!1,r=null;return{useBody:function(n,a){switch(typeof n){case"object":if(!t){var i=d(n)?n.map((function(e){return[y(e)]})):f(n);r={takeStateAndCalculateValue:function(e){return Object.fromEntries(i.map((function(t){var r=u(t,1)[0];return[r,e[r]]})))},initValues:i};break}r=null;break;case"function":if(!t){var o=f(n());r={takeStateAndCalculateValue:function(e){return Object.fromEntries(o.map((function(t){var r=u(t,1)[0];return[r,e[r]]})))},initValues:o};break}r=null;break;default:var c=y(n);if(!t||null!==e&&c!==e){r={takeStateAndCalculateValue:function(e){return e[c]},initValues:[[c,g(a)?a():a]]},e=c;break}r=null}return t=!0,v()(r)}}}));return(0,u(n,1)[0].useBody)(e,r)};b.acceptSelector=function(e){return(0,u(t.useState((function(){var e=!1;return{useBody:function(t){var r=e?null:{takeStateAndCalculateValue:t};return e=!0,v()(r)}}})),1)[0].useBody)(e)};var m=function(e){return d(e)?Object.fromEntries(e.map((function(e){return[e,n(y(e))]}))):n(y(e))};return m.acceptSelector=function(e){return o(e)},{useInterstate:b,setInterstate:function(e,t){switch(typeof e){case"object":f(e).forEach((function(e){var t=u(e,2),n=t[0],a=t[1];r(n,(function(){return a}))}));break;case"function":f(o(e)).forEach((function(e){var t=u(e,2),r=t[0],n=t[1];a(r,n)}));break;default:r(y(e),t)}function r(e,t){a(e,g(t)?t(n(e)):t)}},readInterstate:m,resetInterstate:i}},Object.defineProperty(e,"__esModule",{value:!0})}));
